<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check-in Manual Supervisor</title>
</head>
<body style="font-family: Arial; padding: 20px; background: #f8f9fa;">
    
    <div style="max-width: 500px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        
        <h2 style="color: #495057; text-align: center; margin-bottom: 30px;">CHECK-IN MANUAL - SUPERVISOR</h2>
        
        <form id="checkinForm">
            
            <!-- AUTO-RECUPERACI√ìN DE T√âCNICO -->
            <div style="margin: 15px 0;">
                <label style="font-weight: bold; color: #495057;">üìß Email T√©cnico:</label><br>
                <input type="email" id="tecnico" required style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 8px; margin-top: 5px;" 
                       placeholder="Se auto-completa desde URL o ingresa manual">
            </div>
            
            <!-- AUTO-RECUPERACI√ìN DE ZONA -->
            <div style="margin: 15px 0;">
                <label style="font-weight: bold; color: #495057;">üè≠ Zona:</label><br>
                <select id="zona" required style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 8px; margin-top: 5px;">
                    <option value="">Se auto-detecta o selecciona manual...</option>
                    <option value="L√≠nea-A">üè≠ L√≠nea-A</option>
                    <option value="L√≠nea-B">üè≠ L√≠nea-B</option>
                    <option value="L√≠nea-C">üè≠ L√≠nea-C</option>
                    <option value="Almac√©n">üì¶ Almac√©n</option>
                    <option value="Utilities">‚ö° Utilities</option>
                    <option value="Oficinas">üè¢ Oficinas</option>
                    <option value="Taller">üîß Taller</option>
                </select>
            </div>
            
            <!-- AUTO-RECUPERACI√ìN DE SUPERVISOR -->
            <div style="margin: 15px 0;">
                <label style="font-weight: bold; color: #495057;">üë§ Email Supervisor:</label><br>
                <input type="email" id="supervisor" required style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 8px; margin-top: 5px;"
                       placeholder="Se auto-detecta turno actual o ingresa manual">
            </div>
            
            <!-- √öNICO CAMPO MANUAL: MOTIVO -->
            <div style="margin: 15px 0;">
                <label style="font-weight: bold; color: #495057;">‚ö†Ô∏è Motivo Check-in Manual:</label><br>
                <select id="motivo" required style="width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 8px; margin-top: 5px;">
                    <option value="">Seleccionar motivo...</option>
                    <option value="GPS_no_funciona">üì± GPS no funciona</option>
                    <option value="Bateria_agotada">üîã Bater√≠a agotada/tel√©fono apagado</option>
                    <option value="Sin_cobertura">üì∂ Sin cobertura m√≥vil</option>
                    <option value="Emergencia_operacional">üö® Emergencia operacional</option>
                    <option value="Equipo_compartido">üîß Equipo/tablet empresa sin GPS</option>
                    <option value="Problema_medico">üè• Problema m√©dico leve (presente)</option>
                    <option value="Llegada_tardia">üïê Llegada tard√≠a justificada</option>
                    <option value="Error_tecnico">‚ö†Ô∏è Error t√©cnico sistema</option>
                    <option value="Otro">üìù Otro motivo</option>
                </select>
            </div>
            
            <!-- OBSERVACIONES OPCIONALES -->
            <div style="margin: 15px 0;">
                <label style="font-weight: bold; color: #495057;">üìù Observaciones adicionales (opcional):</label><br>
                <textarea id="observaciones" placeholder="Detalles adicionales del motivo..." 
                         style="width: 100%; height: 80px; padding: 12px; border: 1px solid #ced4da; border-radius: 8px; margin-top: 5px; resize: vertical;"></textarea>
            </div>
            
            <!-- INFO AUTO-DETECTADA -->
            <div id="autoInfo" style="background: #e9ecef; padding: 15px; border-radius: 8px; margin: 20px 0; font-size: 14px; color: #6c757d;">
                <strong>‚ÑπÔ∏è Info auto-detectada:</strong><br>
                <span id="infoText">Cargando datos autom√°ticos...</span>
            </div>
            
            <button type="submit" style="width: 100%; background: #28a745; color: white; padding: 15px; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 20px;">
                ‚úÖ AUTORIZAR CHECK-IN MANUAL
            </button>
            
            <div style="text-align: center; margin-top: 15px;">
                <small style="color: #6c757d;">Solo usar cuando t√©cnico presente f√≠sicamente pero GPS falla</small>
            </div>
            
        </form>
    </div>
    
    <script>
        // AUTO-RECUPERACI√ìN AL CARGAR
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            
            // Auto-completar t√©cnico si viene en URL
            if (params.get('tecnico')) {
                document.getElementById('tecnico').value = params.get('tecnico');
            }
            
            // Auto-seleccionar zona si viene en URL
            if (params.get('zona')) {
                document.getElementById('zona').value = params.get('zona');
            }
            
            // Auto-detectar supervisor por turno actual
            const horaActual = new Date().getHours();
            let supervisorSugerido = "";
            let turnoActual = "";
            
            if (horaActual >= 6 && horaActual < 14) {
                supervisorSugerido = "supervisor.campo.a@empresa.com";
                turnoActual = "A (06:00-14:00)";
            } else if (horaActual >= 14 && horaActual < 22) {
                supervisorSugerido = "supervisor.campo.b@empresa.com";
                turnoActual = "B (14:00-22:00)";
            } else {
                supervisorSugerido = "supervisor.campo.c@empresa.com";
                turnoActual = "C (22:00-06:00)";
            }
            
            document.getElementById('supervisor').value = supervisorSugerido;
            
            // Mostrar info auto-detectada
            document.getElementById('infoText').innerHTML = 
                `Turno detectado: ${turnoActual}<br>` +
                `Supervisor sugerido: ${supervisorSugerido}<br>` +
                `Hora actual: ${new Date().toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'})}`;
        };
        
        // ENV√çO DE FORMULARIO
        document.getElementById('checkinForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const tecnico = document.getElementById('tecnico').value;
            const zona = document.getElementById('zona').value;
            const supervisor = document.getElementById('supervisor').value;
            const motivo = document.getElementById('motivo').value;
            const observaciones = document.getElementById('observaciones').value;
            
            // Validaci√≥n
            if (!tecnico || !zona || !supervisor || !motivo) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }
            
            // URL webhook
            const url = "https://hook.eu2.make.com/XXXXXXXX" +
                       "?tecnico=" + encodeURIComponent(tecnico) +
                       "&zona=" + encodeURIComponent(zona) +
                       "&supervisor=" + encodeURIComponent(supervisor) +
                       "&motivo=" + encodeURIComponent(motivo) +
                       "&observaciones=" + encodeURIComponent(observaciones) +
                       "&manual=true" +
                       "&timestamp=" + Math.floor(Date.now()/1000);
            
            // Confirmaci√≥n antes de enviar
            if (confirm(`‚úÖ Confirmar check-in manual:\n\nT√©cnico: ${tecnico}\nZona: ${zona}\nMotivo: ${motivo}\n\n¬øProceder?`)) {
                window.location.href = url;
            }
        });
    </script>
    
</body>
</html>
